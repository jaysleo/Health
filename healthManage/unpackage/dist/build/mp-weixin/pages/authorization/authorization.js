(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/authorization/authorization"],{"0ca9":function(e,n,t){"use strict";var o=t("652a"),a=t.n(o);a.a},"2d93":function(e,n,t){"use strict";t.r(n);var o=t("4252"),a=t("7509");for(var s in a)"default"!==s&&function(e){t.d(n,e,(function(){return a[e]}))}(s);t("0ca9");var i,u=t("f0c5"),c=Object(u["a"])(a["default"],o["b"],o["c"],!1,null,"8e9a64f4",null,!1,o["a"],i);n["default"]=c.exports},3180:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=getApp(),o={data:function(){return{canIUseGetUserProfile:!1,wechatInfo:"",phoneModal:!1,changeDateModal:!1,localUserInfo:{},isYxb:"",phone:"",sickenTime:"",taskList:[]}},onLoad:function(){e.getUserProfile&&(this.canIUseGetUserProfile=!0),this.getTask()},onShow:function(){e.setStorageSync("wechatInfo")&&(this.phoneModal=!0)},methods:{getTask:function(){var n=this;wx.request({url:t.globalData.https+"/task/taskList",method:"POST",data:{sjkids:e.getStorageSync("sjkids")?e.getStorageSync("sjkids"):"0e12"},success:function(e){1==e.data.code?n.taskList=e.data.data:console.log(e.data.message)}})},dateChange:function(e){this.sickenTime=e.result},getUserProfile:function(){var n=this;e.getUserProfile({desc:"用于完善会员资料",success:function(e){console.log(e),n.wechatInfo=e.userInfo,n.login()}})},getUserInfo:function(e){"getUserInfo:ok"==e.detail.errMsg&&(this.wechatInfo=e.detail.userInfo,this.login())},login:function(){var n=this;e.login({success:function(o){console.log(o),wx.request({url:t.globalData.https+"/Auth/miniProgramAuth",method:"POST",data:{code:o.code,nickName:n.wechatInfo.nickName,avatarUrl:n.wechatInfo.avatarUrl,country:n.wechatInfo.country,province:n.wechatInfo.province,city:n.wechatInfo.city,gender:n.wechatInfo.gender,templageid:e.getStorageSync("sjkids")},success:function(t){if(1==t.data.code){n.localUserInfo=t.data.data,e.setStorageSync("userInfo",n.localUserInfo),e.setStorageSync("uid",n.localUserInfo.id);var o=[];for(var a in n.taskList)o.push(0);e.setStorageSync("task",o),n.phoneModal=!0}else wx.showToast({title:t.data.msg,icon:"none"})}})}})},save:function(){var n=this;return this.localUserInfo.name?this.localUserInfo.idcard?this.phone?void wx.request({url:t.globalData.https+"/wechat/queryOpenid",method:"POST",data:{unionid:this.localUserInfo.unionid},success:function(o){wx.request({url:t.globalData.doctorHttps+"/addPatient",method:"POST",data:{name:n.localUserInfo.name,phone:n.phone,openid:o.data.data,miniOpenid:n.localUserInfo.openid,unionid:n.localUserInfo.unionid,gender:n.localUserInfo.gender,nickName:n.localUserInfo.nickName,avatarUrl:n.localUserInfo.avatarUrl,country:n.localUserInfo.country,province:n.localUserInfo.province,city:n.localUserInfo.city,idcard:n.localUserInfo.idcard,source:"miniProgram",templateid:e.getStorageSync("sjkids")},success:function(t){console.log(t.data.success),t.data.success&&(e.setStorageSync("userInfo",t.data.result),e.setStorageSync("name",t.data.result.name),e.setStorageSync("phone",n.phone),e.setStorageSync("uid",t.data.result._id),e.showToast({title:"授权成功",icon:"success",success:function(n){"595f"==e.getStorageSync("sjkids")&&e.navigateTo({url:"/pages/index/index"}),"196a"==e.getStorageSync("sjkids")?e.navigateTo({url:"../report/reportXxxq"}):e.reLaunch({url:"/pages/index/index"})}}))}})}}):(e.showToast({title:"请填写手机号",icon:"none"}),!1):(e.showToast({title:"请填写您的身份证号",icon:"none"}),!1):(e.showToast({title:"请填写您的姓名",icon:"none"}),!1)},getPhone:function(e){var n=this;wx.request({url:t.globalData.https+"/Auth/getPhone",method:"POST",data:{sessionKey:this.localUserInfo.session_key,encryptedData:e.detail.encryptedData,iv:e.detail.iv},success:function(e){1==e.data.code?n.phone=e.data.data.purePhoneNumber:wx.showToast({title:e.data.msg,icon:"none"})}})}}};n.default=o}).call(this,t("543d")["default"])},4252:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return s})),t.d(n,"a",(function(){return o}));var o={uImage:function(){return t.e("node-modules/uview-ui/components/u-image/u-image").then(t.bind(null,"862e"))},uButton:function(){return t.e("node-modules/uview-ui/components/u-button/u-button").then(t.bind(null,"e587"))},uModal:function(){return t.e("node-modules/uview-ui/components/u-modal/u-modal").then(t.bind(null,"f564"))},uForm:function(){return t.e("node-modules/uview-ui/components/u-form/u-form").then(t.bind(null,"d921"))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,"13db"))},uInput:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-input/u-input")]).then(t.bind(null,"9086"))},uCalendar:function(){return t.e("node-modules/uview-ui/components/u-calendar/u-calendar").then(t.bind(null,"4a40"))}},a=function(){var e=this,n=e.$createElement;e._self._c},s=[]},"652a":function(e,n,t){},7509:function(e,n,t){"use strict";t.r(n);var o=t("3180"),a=t.n(o);for(var s in o)"default"!==s&&function(e){t.d(n,e,(function(){return o[e]}))}(s);n["default"]=a.a},"811a":function(e,n,t){"use strict";(function(e){t("4766");o(t("66fd"));var n=o(t("2d93"));function o(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])}},[["811a","common/runtime","common/vendor"]]]);