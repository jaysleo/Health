(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/advisory/advisory"],{"1a15":function(t,e,n){},"65f2":function(t,e,n){"use strict";n.r(e);var o=n("d510"),a=n("8bd9");for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("6bad");var r,s=n("f0c5"),u=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,"149ab3e2",null,!1,o["a"],r);e["default"]=u.exports},"6bad":function(t,e,n){"use strict";var o=n("1a15"),a=n.n(o);a.a},"8bd9":function(t,e,n){"use strict";n.r(e);var o=n("db15"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a},aed9:function(t,e,n){"use strict";(function(t){n("4766");o(n("66fd"));var e=o(n("65f2"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d510:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={uAvatar:function(){return n.e("node-modules/uview-ui/components/u-avatar/u-avatar").then(n.bind(null,"a326"))},uIcon:function(){return n.e("node-modules/uview-ui/components/u-icon/u-icon").then(n.bind(null,"f2a6"))},uImage:function(){return n.e("node-modules/uview-ui/components/u-image/u-image").then(n.bind(null,"862e"))},uSearch:function(){return n.e("node-modules/uview-ui/components/u-search/u-search").then(n.bind(null,"7f2a"))}},a=function(){var t=this,e=t.$createElement;t._self._c},i=[]},db15:function(t,e,n){"use strict";(function(t){function n(t){return r(t)||i(t)||a(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(t,e){if(t){if("string"===typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function i(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function r(t){if(Array.isArray(t))return s(t)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=getApp(),c={data:function(){return{userInfo:"",phone:"",illnessInfo:"",msgList:[],keyword:"",setIntervalId:"",doctorHttps:"",img:""}},onShow:function(){var e=this;if(!t.getStorageSync("uid")||!t.getStorageSync("phone"))return t.navigateTo({url:"/pages/authorization/authorization"}),!1;this.userInfo=t.getStorageSync("userInfo"),this.phone=t.getStorageSync("phone"),this.doctorHttps=u.globalData.doctorHttps,t.getStorageSync("illnessInfo")&&(this.illnessInfo=t.getStorageSync("illnessInfo"),this.getChatResetg(),this.getMsgList(),this.setIntervalId=setInterval((function(){e.getMsgList()}),3e3))},onUnload:function(){clearInterval(this.setIntervalId)},methods:{sendMsg:function(){var e=this;if(!this.keyword)return t.showToast({title:"请填写咨询内容",icon:"none"}),!1;var o=(new Date).valueOf().toString();wx.request({url:u.globalData.appHttps+"/chat",method:"POST",data:{id:o,senderid:t.getStorageSync("phone"),sendername:this.userInfo.nickName,receiverid:this.illnessInfo.id,receivername:this.illnessInfo.doctorname,msg:this.keyword},success:function(a){if(200==a.data.code){var i={id:o,isMine:!0,type:1,msg:e.keyword};e.msgList=[].concat(n(e.msgList),[i]),e.keyword="",setTimeout((function(){t.pageScrollTo({scrollTop:9999,duration:0})}),100)}}})},sendImgMsg:function(){var e=this,o=(new Date).valueOf().toString();wx.request({url:u.globalData.appHttps+"/chat",method:"POST",data:{id:o,senderid:t.getStorageSync("phone"),sendername:this.userInfo.nickName,receiverid:this.illnessInfo.id,receivername:this.illnessInfo.doctorname,type:3,msg:this.img},success:function(a){if(200==a.data.code){var i={id:o,isMine:!0,type:3,msg:e.img};e.msgList=[].concat(n(e.msgList),[i]),e.keyword="",setTimeout((function(){t.pageScrollTo({scrollTop:9999,duration:0})}),500)}}})},uploadImg:function(){var e=this;t.chooseImage({success:function(n){var o=n.tempFilePaths;t.uploadFile({url:"https://api.ifufan.com:8800/upload",filePath:o[0],name:"img",formData:{},success:function(t){console.log(t.data);var n=JSON.parse(t.data).data.filename;e.img="https://api.ifufan.com:8800/img/"+n,e.sendImgMsg()}})}})},getChatResetg:function(){wx.request({url:u.globalData.appHttps+"/chat/reset",method:"GET",data:{receiverid:t.getStorageSync("phone")}})},getMsgList:function(){var e=this;wx.request({url:u.globalData.appHttps+"/chat",method:"GET",data:{senderid:t.getStorageSync("phone"),receiverid:this.illnessInfo.id},success:function(n){200==n.data.code&&n.data.data.length!=e.msgList.length&&(n.data.data.forEach((function(e){e.isMine=e.senderid==t.getStorageSync("phone"),2==e.type&&(e.msg=JSON.parse(e.msg))})),e.msgList=n.data.data,console.log(e.msgList),setTimeout((function(){t.pageScrollTo({scrollTop:9999,duration:0})}),100))}})},toH5:function(e){t.navigateTo({url:"/pages/h5/h5?url="+encodeURIComponent(JSON.stringify(e))})}}};e.default=c}).call(this,n("543d")["default"])}},[["aed9","common/runtime","common/vendor"]]]);