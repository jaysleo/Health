(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/authorization/authorization"],{"26dc":function(e,n,o){"use strict";var t=o("4ef2"),a=o.n(t);a.a},"4ef2":function(e,n,o){},"6e51":function(e,n,o){"use strict";o.d(n,"b",(function(){return a})),o.d(n,"c",(function(){return i})),o.d(n,"a",(function(){return t}));var t={uImage:function(){return o.e("node-modules/uview-ui/components/u-image/u-image").then(o.bind(null,"6bbe"))},uButton:function(){return o.e("node-modules/uview-ui/components/u-button/u-button").then(o.bind(null,"a022"))},uModal:function(){return o.e("node-modules/uview-ui/components/u-modal/u-modal").then(o.bind(null,"ed67"))},uForm:function(){return o.e("node-modules/uview-ui/components/u-form/u-form").then(o.bind(null,"800d"))},uFormItem:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(o.bind(null,"6bde"))},uInput:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-input/u-input")]).then(o.bind(null,"1d64"))},uRadioGroup:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-radio-group/u-radio-group")]).then(o.bind(null,"6f90"))},uRadio:function(){return o.e("node-modules/uview-ui/components/u-radio/u-radio").then(o.bind(null,"8a60"))},uPicker:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-picker/u-picker")]).then(o.bind(null,"329d"))}},a=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.sickenTimeModal=!0},e.e1=function(n){e.sickenTimeModal=!0},e.e2=function(n){e.sickenTimeModal=!0},e.e3=function(n){e.sickenTimeModal=!0})},i=[]},"6eaf":function(e,n,o){"use strict";(function(e){o("a76a");t(o("66fd"));var n=t(o("acc2"));function t(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,o("543d")["createPage"])},"8b7f":function(e,n,o){"use strict";o.r(n);var t=o("b4ab"),a=o.n(t);for(var i in t)"default"!==i&&function(e){o.d(n,e,(function(){return t[e]}))}(i);n["default"]=a.a},acc2:function(e,n,o){"use strict";o.r(n);var t=o("6e51"),a=o("8b7f");for(var i in a)"default"!==i&&function(e){o.d(n,e,(function(){return a[e]}))}(i);o("26dc");var s,c=o("f0c5"),r=Object(c["a"])(a["default"],t["b"],t["c"],!1,null,"07feb0aa",null,!1,t["a"],s);n["default"]=r.exports},b4ab:function(e,n,o){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=getApp(),t={data:function(){return{canIUseGetUserProfile:!1,wechatInfo:"",phoneModal:!1,sickenTimeModal:!1,localUserInfo:{},isYxb:"",phone:"",sickenTime:"",taskList:[]}},onLoad:function(){e.getUserProfile&&(this.canIUseGetUserProfile=!0),this.getTask()},onShow:function(){e.setStorageSync("wechatInfo")&&(this.phoneModal=!0)},methods:{getTask:function(){var n=this;wx.request({url:o.globalData.https+"/task/taskList",method:"POST",data:{sjkids:e.getStorageSync("sjkids")?e.getStorageSync("sjkids"):"oe12"},success:function(e){1==e.data.code?n.taskList=e.data.data:console.log(e.data.message)}})},sickenTimeChange:function(e){this.sickenTime=e.year+"-"+e.month+"-"+e.day},getUserProfile:function(){var n=this;e.getUserProfile({desc:"用于完善会员资料",success:function(e){console.log(e),n.wechatInfo=e.userInfo,n.login()}})},getUserInfo:function(e){"getUserInfo:ok"==e.detail.errMsg&&(this.wechatInfo=e.detail.userInfo,this.login())},login:function(){var n=this;e.login({success:function(t){console.log(t),wx.request({url:o.globalData.https+"/Auth/miniProgramAuth",method:"POST",data:{code:t.code,nickName:n.wechatInfo.nickName,avatarUrl:n.wechatInfo.avatarUrl,country:n.wechatInfo.country,province:n.wechatInfo.province,city:n.wechatInfo.city,gender:n.wechatInfo.gender,templageid:e.getStorageSync("sjkids")},success:function(o){1==o.data.code?(n.localUserInfo=o.data.data,e.setStorageSync("userInfo",n.localUserInfo),e.setStorageSync("uid",n.localUserInfo.id),n.phoneModal=!0):wx.showToast({title:o.data.msg,icon:"none"})}})}})},save:function(){var n=this;return this.localUserInfo.name?this.localUserInfo.idcard?this.isYxb?!this.sickenTime&&this.isYxb?(e.showToast({title:"请选择第一次发病时间",icon:"none"}),!1):this.localUserInfo.relation||"2"!=this.isYxb?this.localUserInfo.suffererName||"2"!=this.isYxb?this.localUserInfo.suffererIdcard||"2"!=this.isYxb?this.phone?/^1[34578]\d{9}$/.test(this.phone)?void wx.request({url:o.globalData.https+"/wechat/queryOpenid",method:"POST",data:{unionid:this.localUserInfo.unionid},success:function(t){wx.request({url:o.globalData.doctorHttps+"/addPatient",method:"POST",data:{templateid:"0e12",name:n.localUserInfo.name,phone:n.phone,openid:t.data.data,miniOpenid:n.localUserInfo.openid,unionid:n.localUserInfo.unionid,gender:n.localUserInfo.gender,nickName:n.localUserInfo.nickName,avatarUrl:n.localUserInfo.avatarUrl,country:n.localUserInfo.country,province:n.localUserInfo.province,city:n.localUserInfo.city,idcard:n.localUserInfo.idcard,relation:n.localUserInfo.relation,suffererName:n.localUserInfo.suffererName,suffererIdcard:n.localUserInfo.suffererIdcard,source:"miniProgram",isYxb:n.isYxb,isPsa:n.localUserInfo.isPsa,firstSickenTime:n.sickenTime},success:function(o){console.log(o.data.success),o.data.success&&(e.setStorageSync("userInfo",o.data.result),e.setStorageSync("name",o.data.result.name),e.setStorageSync("phone",n.phone),e.setStorageSync("uid",o.data.result._id),e.showToast({title:"授权成功",icon:"success",success:function(n){e.navigateTo({url:"../report/report"})}}))}})}}):(e.showToast({title:"请填写手正确的手机号",icon:"none"}),!1):(e.showToast({title:"请填写手机号",icon:"none"}),!1):(e.showToast({title:"请填写患者身份证号",icon:"none"}),!1):(e.showToast({title:"请填写患者姓名",icon:"none"}),!1):(e.showToast({title:"请选择患者与您的关系",icon:"none"}),!1):(e.showToast({title:"请选择是否是银屑病患者",icon:"none"}),!1):(e.showToast({title:"请填写您的身份证号",icon:"none"}),!1):(e.showToast({title:"请填写您的姓名",icon:"none"}),!1)},getPhone:function(e){var n=this;wx.request({url:o.globalData.https+"/Auth/getPhone",method:"POST",data:{sessionKey:this.localUserInfo.session_key,encryptedData:e.detail.encryptedData,iv:e.detail.iv},success:function(e){1==e.data.code?n.phone=e.data.data.purePhoneNumber:wx.showToast({title:e.data.msg,icon:"none"})}})}}};n.default=t}).call(this,o("543d")["default"])}},[["6eaf","common/runtime","common/vendor"]]]);