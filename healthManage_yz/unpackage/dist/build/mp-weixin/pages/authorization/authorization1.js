(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/authorization/authorization1"],{"3c27":function(e,n,t){"use strict";t.r(n);var o=t("721b"),a=t.n(o);for(var s in o)"default"!==s&&function(e){t.d(n,e,(function(){return o[e]}))}(s);n["default"]=a.a},"721b":function(e,n,t){"use strict";(function(e){function t(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=getApp(),a={data:function(){return{canIUseGetUserProfile:!1,wechatInfo:"",phoneModal:!1,changeDateModal:!1,localUserInfo:{},isYxb:"",phone:"",sickenTime:"",taskList:[]}},onLoad:function(){e.getUserProfile&&(this.canIUseGetUserProfile=!0),this.getTask()},onShow:function(){e.setStorageSync("wechatInfo")&&(this.phoneModal=!0)},methods:{getTask:function(){var n=this;wx.request({url:o.globalData.https+"/task/taskList",method:"POST",data:{sjkids:e.getStorageSync("sjkids")?e.getStorageSync("sjkids"):"oe12"},success:function(e){1==e.data.code?n.taskList=e.data.data:console.log(e.data.message)}})},dateChange:function(e){this.sickenTime=e.result},getUserProfile:function(){var n=this;e.getUserProfile({desc:"用于完善会员资料",success:function(e){console.log(e),n.wechatInfo=e.userInfo,n.login()}})},getUserInfo:function(e){"getUserInfo:ok"==e.detail.errMsg&&(this.wechatInfo=e.detail.userInfo,this.login())},login:function(){var n=this;e.login({success:function(t){console.log(t),wx.request({url:o.globalData.https+"/Auth/miniProgramAuth",method:"POST",data:{code:t.code,nickName:n.wechatInfo.nickName,avatarUrl:n.wechatInfo.avatarUrl,country:n.wechatInfo.country,province:n.wechatInfo.province,city:n.wechatInfo.city,gender:n.wechatInfo.gender,templageid:e.getStorageSync("sjkids")},success:function(t){if(1==t.data.code){n.localUserInfo=t.data.data,e.setStorageSync("userInfo",n.localUserInfo),e.setStorageSync("uid",n.localUserInfo.id);var o=[];for(var a in n.taskList)o.push(0);e.setStorageSync("task",o),n.phoneModal=!0}else wx.showToast({title:t.data.msg,icon:"none"})}})}})},save:function(){var n=this;return this.localUserInfo.name?this.localUserInfo.idcard?this.phone?void wx.request({url:o.globalData.https+"/wechat/queryOpenid",method:"POST",data:{unionid:this.localUserInfo.unionid},success:function(a){wx.request({url:o.globalData.doctorHttps+"/addPatient",method:"POST",data:t({templateid:"0e12",name:n.localUserInfo.name,phone:n.phone,openid:a.data.data,miniOpenid:n.localUserInfo.openid,unionid:n.localUserInfo.unionid,gender:n.localUserInfo.gender,nickName:n.localUserInfo.nickName,avatarUrl:n.localUserInfo.avatarUrl,country:n.localUserInfo.country,province:n.localUserInfo.province,city:n.localUserInfo.city,idcard:n.localUserInfo.idcard,source:"miniProgram"},"templateid",e.getStorageSync("sjkids")),success:function(t){console.log(t.data.success),t.data.success&&(e.setStorageSync("userInfo",t.data.result),e.setStorageSync("name",t.data.result.name),e.setStorageSync("phone",n.phone),e.setStorageSync("uid",t.data.result._id),e.showToast({title:"授权成功",icon:"success",success:function(n){"595f"==e.getStorageSync("sjkids")&&e.navigateTo({url:"../report/report1"}),"196a"==e.getStorageSync("sjkids")&&e.navigateTo({url:"../report/report2"})}}))}})}}):(e.showToast({title:"请填写手机号",icon:"none"}),!1):(e.showToast({title:"请填写您的身份证号",icon:"none"}),!1):(e.showToast({title:"请填写您的姓名",icon:"none"}),!1)},getPhone:function(e){var n=this;wx.request({url:o.globalData.https+"/Auth/getPhone",method:"POST",data:{sessionKey:this.localUserInfo.session_key,encryptedData:e.detail.encryptedData,iv:e.detail.iv},success:function(e){1==e.data.code?n.phone=e.data.data.purePhoneNumber:wx.showToast({title:e.data.msg,icon:"none"})}})}}};n.default=a}).call(this,t("543d")["default"])},"73b3":function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return s})),t.d(n,"a",(function(){return o}));var o={uImage:function(){return t.e("node-modules/uview-ui/components/u-image/u-image").then(t.bind(null,"6bbe"))},uButton:function(){return t.e("node-modules/uview-ui/components/u-button/u-button").then(t.bind(null,"a022"))},uModal:function(){return t.e("node-modules/uview-ui/components/u-modal/u-modal").then(t.bind(null,"ed67"))},uForm:function(){return t.e("node-modules/uview-ui/components/u-form/u-form").then(t.bind(null,"800d"))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,"6bde"))},uInput:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-input/u-input")]).then(t.bind(null,"1d64"))},uCalendar:function(){return t.e("node-modules/uview-ui/components/u-calendar/u-calendar").then(t.bind(null,"0b77"))}},a=function(){var e=this,n=e.$createElement;e._self._c},s=[]},ae11:function(e,n,t){"use strict";(function(e){t("a76a");o(t("66fd"));var n=o(t("daa2"));function o(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},cf4b:function(e,n,t){"use strict";var o=t("d8b7"),a=t.n(o);a.a},d8b7:function(e,n,t){},daa2:function(e,n,t){"use strict";t.r(n);var o=t("73b3"),a=t("3c27");for(var s in a)"default"!==s&&function(e){t.d(n,e,(function(){return a[e]}))}(s);t("cf4b");var i,r=t("f0c5"),u=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"6a76be02",null,!1,o["a"],i);n["default"]=u.exports}},[["ae11","common/runtime","common/vendor"]]]);